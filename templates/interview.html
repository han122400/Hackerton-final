<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AI ëª¨ì˜ë©´ì ‘ â€“ ì¸í„°ë·°</title>

    <!-- Bootstrap only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* ì¹´ë©”ë¼ í”„ë¦¬ë·° ì¹´ë“œ */
      .preview-wrap {
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.06);
      }
      video#video {
        width: 100%;
        height: auto;
        display: block;
        background: #0b1320;
      }

      /* ìƒíƒœ ì¹´ë“œ ì•ˆ ë°°ì§€ë“¤(ì™¼ìª½ ì •ë ¬) */
      .state-badge {
        min-width: 120px;
        background: #f6f8fb;
        border-radius: 0.75rem;
        padding: 0.75rem 1rem;
        font-weight: 700;
        color: #202636;
      }
      .state-badge small {
        color: #667085;
        font-weight: 600;
      }

      /* ì˜¤ë¥¸ìª½ ë…¹í™” ìƒíƒœ ë™ê·¸ë¼ë¯¸ */
      .rec-indicator {
        position: relative;
        width: 44px;
        height: 44px;
        border-radius: 999px;
        background: #ef4444; /* ê¸°ë³¸ ì  */
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6);
      }
      .rec-indicator.active {
        animation: recPulse 1.4s ease-in-out infinite;
      }
      @keyframes recPulse {
        0% {
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6);
          transform: scale(1);
        }
        70% {
          box-shadow: 0 0 0 16px rgba(239, 68, 68, 0);
          transform: scale(1.06);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
          transform: scale(1);
        }
      }

      /* STT ì˜ì—­ */
      .stt-box {
        border-radius: 0.75rem;
        padding: 1rem;
        background: #0b1320;
        color: #cbd5e1;
        min-height: 180px;
        white-space: pre-wrap;
      }

      /* ì§ˆë¬¸ í…ìŠ¤íŠ¸ */
      .question-box {
        border-radius: 0.75rem;
        background: #f8fafc;
        padding: 1rem;
        min-height: 74px;
        display: flex;
        align-items: center;
        font-weight: 600;
        color: #111827;
      }
    </style>
  </head>
  <body class="bg-light">
    <main class="container py-4 py-md-5">
      <!-- ìƒë‹¨ ì •ë³´ -->
      <div
        class="d-flex flex-wrap align-items-center justify-content-between mb-3"
      >
        <div class="me-3">
          <div class="h5 mb-1" id="interviewCompany">íšŒì‚¬ëª…</div>
          <div class="text-secondary">
            ì§€ì› ì§ë¬´: <span id="interviewPosition">ì§ë¬´ëª…</span>
          </div>
        </div>
        <div class="text-end">
          <div class="small text-secondary">ì§„í–‰ ì‹œê°„</div>
          <div class="h4 mb-0"><span id="timer">00:00</span></div>
        </div>
      </div>

      <!-- ì¹´ë©”ë¼ í”„ë¦¬ë·° & ì§ˆë¬¸/ìƒíƒœ -->
      <div class="row g-4">
        <!-- ì¢Œ: ì¹´ë©”ë¼ í”„ë¦¬ë·° -->
        <div class="col-12 col-lg-7">
          <section class="preview-wrap">
            <video
              id="video"
              autoplay
              playsinline
              muted
              class="bg-dark"
            ></video>
          </section>
          <!-- canvasëŠ” WebSocket ì „ì†¡ìš©, í™”ë©´ì—” ìˆ¨ê¹€ -->
          <canvas id="canvas" class="d-none"></canvas>
          <!-- camera_ai.jsê°€ ë¡œê·¸ë¥¼ ì“°ë¯€ë¡œ ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ ìˆ¨ê¹€ -->
          <div id="log" class="d-none" aria-hidden="true"></div>
        </div>

        <!-- ìš°: ì§ˆë¬¸/ìƒíƒœ/ìŒì„± í…ìŠ¤íŠ¸ -->
        <div class="col-12 col-lg-5">
          <!-- (1) í˜„ì¬ ì§ˆë¬¸ -->
          <section class="card shadow-sm mb-3">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <h2 class="h6 mb-0">
                  í˜„ì¬ ì§ˆë¬¸
                  <span class="text-secondary"
                    >( <span id="currentQuestion">1</span> /
                    <span id="totalQuestions">5</span> )</span
                  >
                </h2>
                <button
                  id="nextQuestionBtn"
                  class="btn btn-primary btn-sm"
                  type="button"
                  onclick="nextQuestion()"
                >
                  ë‹¤ìŒ ì§ˆë¬¸
                </button>
              </div>
              <div id="questionText" class="question-box">
                ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦
              </div>
            </div>
          </section>

          <!-- (2) í˜„ì¬ ìƒíƒœ (ì™¼ìª½ ë°°ì§€ / ì˜¤ë¥¸ìª½ ë…¹í™” ë™ê·¸ë¼ë¯¸) -->
          <section class="card shadow-sm mb-3">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h2 class="h6 mb-0">í˜„ì¬ ìƒíƒœ</h2>
                <!-- ìš°ì¸¡ ì›í˜• ì• ë‹ˆë©”ì´ì…˜ -->
                <div class="d-flex align-items-center gap-2">
                  <span class="text-secondary small">ë…¹ìŒ ì¤‘</span>
                  <div id="recDot" class="rec-indicator"></div>
                </div>
              </div>

              <div class="row g-2 align-items-stretch">
                <div class="col-12 col-md-4">
                  <div
                    class="state-badge h-100 d-flex align-items-center justify-content-between"
                  >
                    <small>ë°©í–¥</small>
                    <span id="dir">-</span>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div
                    class="state-badge h-100 d-flex align-items-center justify-content-between"
                  >
                    <small>ì‹œì„ </small>
                    <span id="gaze">-</span>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div
                    class="state-badge h-100 d-flex align-items-center justify-content-between"
                  >
                    <small>ë¯¸ì†Œ</small>
                    <span id="smile">-</span>
                  </div>
                </div>
              </div>

              <div class="mt-3 small text-secondary">
                â€» 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.
                <span class="ms-2"
                  >íƒœë„ ì ìˆ˜: <strong id="score">0</strong></span
                >
              </div>
            </div>
          </section>

          <!-- (3) STT(ì‚¬ìš©ì ìŒì„± â†’ í…ìŠ¤íŠ¸) -->
          <section class="card shadow-sm">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <h2 class="h6 mb-0">ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹(STT)</h2>
                <span id="sttAuto" class="small text-secondary">ìë™ ê°±ì‹ </span>
              </div>
              <div id="sttText" class="stt-box">
                ë§í•˜ê¸°ë¥¼ ì‹œì‘í•˜ë©´ ì—¬ê¸°ì— ë³€í™˜ëœ í…ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ë“¤: ìˆœì„œ ì¤‘ìš” (data â†’ app/api â†’ camera â†’ interview) -->
    <script src="/static/js/data.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/camera_ai.js"></script>
    <script src="/static/js/interview_ai.js"></script>
    <script src="/static/js/interview.js"></script>

    <script>
      // ğŸ”´ ìš°ì¸¡ ë™ê·¸ë¼ë¯¸ì— â€œì´¬ì˜/ìº¡ì²˜ ì¤‘â€ ëŠë‚Œì„ ì£¼ê¸° ìœ„í•œ ê°„ë‹¨ í† ê¸€
      // - camera_ai.jsê°€ video.srcObjectë¥¼ ì„¸íŒ…í•˜ë©´ í™œì„±í™”
      // - ëŠê¸°ë©´ ë¹„í™œì„±í™”
      (function () {
        const dot = document.getElementById("recDot");
        const video = document.getElementById("video");
        // ìµœì´ˆ ë¡œë”© í›„ ì£¼ê¸°ì ìœ¼ë¡œ ìƒíƒœ ì²´í¬
        setInterval(() => {
          if (video && video.srcObject) {
            dot.classList.add("active");
          } else {
            dot.classList.remove("active");
          }
        }, 500);
        // metadata ë¡œë“œ ì‹œ ë°”ë¡œ ë°˜ì˜
        video?.addEventListener("loadedmetadata", () =>
          dot.classList.add("active")
        );
      })();
    </script>
  </body>
</html>
